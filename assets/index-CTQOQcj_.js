(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function n(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(r){if(r.ep)return;r.ep=!0;const l=n(r);fetch(r.href,l)}})();function q(e){const n=Math.PI*2/8;for(let o=0;o<8;o++){let r=Math.round(Math.cos(n*o)),l=Math.round(Math.sin(n*o));e(r,l)}}function C(e,t){for(let n=0;n<e.length;n++)for(let o=0;o<e[0].length;o++)if(t(o,n))return}function y(e,t){return e!==0&&(t===0&&e<0||t===1&&e>0)}function k(e,t){return e!==0&&(t===0&&e>0||t===1&&e<0)}function P(e){return e?-1:1}function A(e){e.chosenFigure=null,e.actionMap=m()}function R(e,t){switch(e){case"p":return[-6,6][t];case"b":return[-5,5][t];case"kn":return[-4,4][t];case"r":return[-3,3][t];case"k":return[-2,2][t];case"q":return[-1,1][t]}}function K(e,t,n){return R(e,t)===n}function F(e,t){return e<=7&&e>=0&&t<=7&&t>=0}function x(e,t){const n={};let o=[];for(const r of e)for(const l of t){const u=JSON.stringify(r),s=JSON.stringify(l);u===s&&!n[u]&&(n[u]=!0,o.push(r))}return o}function m(){return new Array(8).fill(0).map(()=>new Array(8).fill(0))}function w(e,t,n){let o=!1,r=[],l=null;for(const u of n){const[s,f]=u[0];if(s===e[0]&&f===e[1]){l=u[1],o=!0;break}}if(o){const[u,s]=l;return t[s][u]=1,r.push([u,s]),r}return[]}function G(e,t,n,o,r){C(t,(l,u)=>{n!=null&&n[u][l]?D(e,l*o,u*o,o,"#92df28",!0):D(e,l*o,u*o,o,(u+l)%2===0?"#7D945D":"#EEEED5"),X(e,l*o,u*o,t[u][l],r,o)})}function X(e,t,n,o,r,l){o&&e.drawImage(r,(Math.abs(o)-1)*60,o>0?0:60,60,60,t,n,l,l)}function D(e,t,n,o,r,l=!1){e.beginPath(),e.fillStyle=r,e.rect(t,n,o,o),e.fill(),l&&e.stroke(),e.closePath()}function N(e,t,n,o,r){for(let l=0;l<r.length;l++)D(t,l*o,0,o,l%2===0?"#7D945D":"#EEEED5"),X(t,l*o,0,e===0?-r[l]:r[l],n,o)}function T([e,t,n],o,r,l=!1){switch(Math.abs(n)){case 6:return H([e,t],o,r);case 5:return Y([e,t],o,r,l);case 4:return U([e,t],o,r);case 3:return S([e,t],o,r,l);case 2:return J([e,t],o,r);case 1:return Q([e,t],o,r,l)}}function H(e,t,n){const o=w(e,t,n.defenders);if(M(o,n))return o;let r=e[1]-1*P(n.playerTurn),l=e[1]-2*P(n.playerTurn),u=e[0],s=e[0]-1*P(n.playerTurn),f=e[0]+1*P(n.playerTurn);return r<0||r>7?o:(k(n.map[r][s],n.playerTurn)&&(t[r][s]=1,o.push([s,r])),k(n.map[r][f],n.playerTurn)&&(t[r][f]=1,o.push([f,r])),(n.playerTurn===1&&e[1]===1||n.playerTurn===0&&e[1]===6)&&n.map[r][u]===0&&n.map[l][u]===0&&!y(n.map[l][u],n.playerTurn)?(t[r][u]=1,t[l][u]=1,o.push([u,r]),o.push([u,l]),o):(n.map[r][u]===0&&(t[r][u]=1,o.push([u,r])),o))}function Y(e,t,n,o=!1){const r=w(e,t,n.defenders);if(M(r,n))return r;function l(u,s){for(let f=0;f<8;f++){const c=u(f),a=s(f);if(!F(c,a)||y(n.map[a][c],n.playerTurn))break;if(!o&&n.map[a][c]!==0){t[a][c]=1,r.push([c,a]);break}t[a][c]=1,r.push([c,a])}}return l(u=>e[0]-u-1,u=>e[1]-u-1),l(u=>e[0]+u+1,u=>e[1]-u-1),l(u=>e[0]-u-1,u=>e[1]+u+1),l(u=>e[0]+u+1,u=>e[1]+u+1),r}function U(e,t,n){const o=w(e,t,n.defenders);if(M(o,n))return o;const r=e[0]-1,l=e[0]-2,u=e[0]+1,s=e[0]+2,f=e[1]-1,c=e[1]-2,a=e[1]+1,g=e[1]+2;d(r,c),d(u,c),d(l,f),d(s,f),d(r,g),d(u,g),d(s,a),d(l,a);function d(p,h){F(p,h)&&(!n.map[h][p]||k(n.map[h][p],n.playerTurn))&&(t[h][p]=1,o.push([p,h]))}return o}function S(e,t,n,o=!1){const r=w(e,t,n.defenders);if(M(r,n))return r;function l(u,s){let f=e[0]-u,c=e[1]-s;for(;F(f,c);){if(y(n.map[c][f],n.playerTurn))return;if(!o&&k(n.map[c][f],n.playerTurn)){t[c][f]=1,r.push([f,c]);break}t[c][f]=1,r.push([f,c]),f-=u,c-=s}}return l(0,1),l(1,0),l(0,-1),l(-1,0),r}function J(e,t,n){let o=[];q((u,s)=>{const f=e[0]+u,c=e[1]+s;F(f,c)&&(y(n.map[c][f],n.playerTurn)||n.hypAttackMap[c][f]||(t[c][f]=1,o.push([f,c])))});const r=n.hasPlayerRooksMoved[n.playerTurn].every(u=>u);if(n.hasPlayerKingsMoved[n.playerTurn]||r)return;function l([u,s],f){if(u===4&&s===7||u===4&&s===0){let c=function(a,g){for(let d=0;d<a-1;d++)if(n.map[s][u+(d+1)*g]!==0)return!1;return!0};n.map[f][0]===R("r",n.playerTurn)&&!n.hasPlayerRooksMoved[n.playerTurn][0]&&c(Math.abs(u),-1)&&(t[f][0]=1,n.isRoquerAllowed=!0),n.map[f][7]===R("r",n.playerTurn)&&!n.hasPlayerRooksMoved[n.playerTurn][1]&&c(Math.abs(u-7),1)&&(t[f][7]=1,n.isRoquerAllowed=!0)}}return l(e,n.playerTurn?0:7),o}function Q(e,t,n,o=!1){let r=w(e,t,n.defenders);return M(r,n)?r:[...Y(e,t,n,o),...S(e,t,n,o)]}function M(e,t){return e.length>0||t.defenders.length>0}const V=""+new URL("image-B9Shrgyd.png",import.meta.url).href,i={canvas:null,ctx:null,canvas2:null,ctx2:null,map:[[3,4,5,1,2,5,4,3],[6,6,6,6,6,6,6,6],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[-6,-6,-6,-6,-6,-6,-6,-6],[-3,-4,-5,-1,-2,-5,-4,-3]],map2:[1,3,4,5],actionMap:m(),cellSize:0,chessFiguresImage:new Image,chessFiguresImageUrl:V,playerTurn:0,lastMoveCoor:null,chosenFigure:null,isKingSave:!0,chessGameId:null,modal:null,mouseCoor:null,canvasChessHeight:500,canvasChessWidth:500,isRoquerAllowed:!1,hasPlayerRooksMoved:[[!1,!1],[!1,!1]],hasPlayerKingsMoved:[!1,!1],hasKingCheck:[!1,!1],hasKingMate:[!1,!1],kingsCoor:[[null,null,null],[null,null,null]],hypAttackMap:m(),defenders:[],kingsFreeFields:0,attackerInfo:[null,null],lastKingCheck:[null,null]};window.addEventListener("load",Z);function Z(){z(),$(),i.chessFiguresImage.addEventListener("load",_)}function _(){function e(){let t=0;C(i.map,(n,o)=>{if(t===2)return!0;Math.abs(i.map[o][n])===2&&(i.kingsCoor[t++]=[n,o,i.map[o][n]])})}e(),E(i),i.canvas.addEventListener("click",ee),i.canvas2.addEventListener("click",v)}function $(){window.addEventListener("mousedown",({pageX:e,pageY:t})=>i.mouseCoor=[e,t])}function z(){i.canvas=document.querySelector("#chess"),i.ctx=i.canvas.getContext("2d"),i.canvas.width=i.canvasChessWidth,i.canvas.height=i.canvasChessHeight,i.cellSize=i.canvas.width/i.map.length,i.canvas2=document.querySelector("#chooseFigureCanvas"),i.ctx2=i.canvas2.getContext("2d"),i.canvas2.width=i.cellSize*4,i.canvas2.height=i.cellSize,i.chessFiguresImage.src=i.chessFiguresImageUrl,i.modal=document.querySelector(".modal")}function E(e){j(e),e.chessGameId=setTimeout(E.bind(null,e),100)}function j({ctx:e,map:t,actionMap:n,cellSize:o,chessFiguresImage:r}){G(e,t,n,o,r)}function v({offsetX:e}){const t=Math.floor(e/60);i.modal.classList.remove("active"),i.map[i.lastMoveCoor[1]][i.lastMoveCoor[0]]=i.playerTurn===0?i.map2[t]:-i.map2[t],E(i)}function ee({offsetX:e,offsetY:t}){const n=Math.floor(e/i.cellSize),o=Math.floor(t/i.cellSize),r=i.map[o][n];if(i.chosenFigure&&i.chosenFigure[0]===n&&i.chosenFigure[1]===o){A(i);return}if(i.chosenFigure&&i.actionMap[o][n]&&ne(i,[n,o])){te(i,[n,o]),A(i),i.playerTurn=+!i.playerTurn;return}if(y(r,i.playerTurn)){i.chosenFigure=[n,o,r],i.actionMap=m(),T(i.chosenFigure,i.actionMap,i);return}A(i)}function ne(e,t){const[n,o,r]=e.chosenFigure,[l,u]=t;function s(){n<4&&(e.hasPlayerRooksMoved[e.playerTurn][0]=!0),n>4&&(e.hasPlayerRooksMoved[e.playerTurn][1]=!0)}if(K("r",e.playerTurn,r)&&e.hasPlayerRooksMoved[e.playerTurn].some(f=>!f)&&s(),K("p",e.playerTurn,r)&&(u===7||u==0)&&(e.modal.classList.add("active"),e.modal.style.top=e.mouseCoor[1]-e.modal.getBoundingClientRect().height+"px",e.modal.style.left=e.mouseCoor[0]-e.modal.getBoundingClientRect().width/2+"px",clearTimeout(e.chessGameId),N(e.playerTurn,e.ctx2,e.chessFiguresImage,e.cellSize,e.map2)),K("k",e.playerTurn,r)&&(e.hasPlayerKingsMoved[e.playerTurn]=!0,e.kingsCoor[e.playerTurn]=[l,u],e.hasKingCheck[e.playerTurn]=!1,e.isRoquerAllowed)){const[f,c,a]=e.chosenFigure,[g,d]=t,p=g-f>0?1:-1,h=f+p*2;return e.map[c][f]=0,e.map[c][h]=a,e.map[d][h+-1*p]=e.map[d][g],e.map[d][g]=0,e.isRoquerAllowed=!1,s(),e.playerTurn=+!e.playerTurn,e.lastMoveCoor=[h,c,a],!1}return!0}function te(e,t){const[n,o,r]=e.chosenFigure,[l,u]=t;e.map[u][l]=r,e.map[o][n]=0,e.defenders=[],e.lastMoveCoor=[l,u,r],le(e)}function oe([e,t],n){const[o,r,l]=n.lastMoveCoor,u=[o,r,l];n.hypAttackMap=m();const s=T(u,n.hypAttackMap,n,!0),f=n.hypAttackMap[t][e]===1;return n.hasKingCheck[n.playerTurn]=f,f&&(n.attackerInfo=[n.lastMoveCoor,s]),f}function re(e){C(e.map,(t,n)=>{const o=[t,n,e.map[n][t]];e.map[n][t]===0||k(o[2],e.playerTurn)||n===e.lastMoveCoor[1]&&t===e.lastMoveCoor[0]||T(o,e.hypAttackMap,e,!0)})}function ue([e,t],n){n.kingsFreeFields=0,q((o,r)=>{const l=e+o,u=t+r;!F(l,u)||y(n.map[u][l],n.playerTurn)||n.hypAttackMap[u][l]||n.kingsFreeFields++})}function le(e){const[t,n]=e.kingsCoor[e.playerTurn];if(t===null||n===null||!oe(e.kingsCoor[e.playerTurn],e))return;re(e),ue([t,n],e);const o=ie(e);e.kingsFreeFields===0&&o.length===0&&(clearTimeout(e.chessGameId),console.log(["White player ","Black player "][e.playerTurn]+" wins"))}function ie(e){const[t]=e.attackerInfo,[n,o,r]=e.kingsCoor[e.playerTurn],[l,u,s]=t;let f=m();return f[o][n]=r,f[u][l]=s,C(e.map,(c,a)=>{k(e.map[a][c],e.playerTurn)&&(f[a][c]=e.map[a][c])}),e.defenders=fe(e,f),e.defenders}function fe(e,t){const[[n,o,r],l]=e.attackerInfo,[u,s,f]=e.kingsCoor[e.playerTurn];let c=[];return C(e.map,(a,g)=>{let d=m();const p=[a,g,e.map[g][a]];if(!y(p[2],+!e.playerTurn)||K("k",+!e.playerTurn,p[2]))return;const h=T(p,d,{...e,map:t,playerTurn:+!e.playerTurn});if(ce([n,o],h)){c.push([p,[n,o]]);return}const W=x(l,h);for(const b of W){const I=m(),L=m(),[B,O]=b;I[s][u]=f,I[O][B]=p[2],I[o][n]=r,T(e.lastMoveCoor,L,{...e,map:I,playerTurn:e.playerTurn}),L[s][u]===0&&c.push([p,b])}}),c}function ce([e,t],n){for(const o of n)if(e===o[0]&&t===o[1])return!0;return!1}
